<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test Run</title>
</head>
<body>
<div id="Greeting" class="frobo-component">
  <h1>Greeting Switcher</h1>
  <p id="text-greeting" data-template="{greeting}, {name}!">Hello, World!</p>
  <button onclick="sayHello()">Say Hello</button>
  <button onclick="sayHi()">Say Hi</button>
  <button onclick="sayHey()">Say Hey</button>
  <button onclick="changeName()">Change Name</button>
</div>

<script>
const Frobo = {
  state: {},
  dependencies: {},
  watch(stateKey, element) {
    if (!this.dependencies[stateKey]) {
      this.dependencies[stateKey] = [];
    }
    this.dependencies[stateKey].push(element);
  },
  createState(initialState) {
    const self = this;
    this.state = new Proxy(initialState, {
      set: (target, property, value) {
        target[property] = value;
        self.updateDOM(property);
        return true;
      }
    });
    return this.state;
  },
  updateDOM(stateKey) {
    const elements = this.dependencies[stateKey];
    if (elements) {
      elements.forEach(element => {
        const template = element.getAttribute('data-template');
        if (template) {
          element.textContent = template.replace(new RegExp('{' + stateKey + '}', 'g'), String(this.state[stateKey]));
        }
      });
    }
  }
};

const state = Frobo.createState({ greeting: "Hello", name: "World" });
let greeting = state.greeting;
let name = state.name;

window.addEventListener('DOMContentLoaded', () => {
  const elem_greeting = document.getElementById('text-greeting');
  if (elem_greeting) Frobo.watch('greeting', elem_greeting);
  const elem_name = document.getElementById('text-name');
  if (elem_name) Frobo.watch('name', elem_name);
});

function sayHello() {
  state.greeting = "Hello";
}

function sayHi() {
  state.greeting = "Hi";
}

function sayHey() {
  state.greeting = "Hey";
}

function changeName() {
  state.name = "Friend";
}

console.log("Frobo app loaded!");
console.log("Functions defined:", typeof sayHello, typeof sayHi, typeof sayHey, typeof changeName);
</script>
</body>
</html>
